---
title: "Report"
author: "Jun, Irene, Binh, Weidun"
date: "12/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-libraries}
library(tidyverse)
library(ggplot2)
library(magrittr)
library(dplyr)
library(readr)
```

```{r load-data}
data <- read.csv("https://wzb-ipi.github.io/corona/df_full.csv")
```

```{r process-data}
new <- data %>%
  filter(elapsed==334)%>%
  select(geoid2, region, continent, country, population_2019, pop_density, deaths_cum, health_exp_pc, soc_insur_cov)

wo_us <- new %>%
  filter(country != "United States")
```

```{r plot-mortality-health-expenses}
ggplot(new, aes(y=deaths_cum, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "All Countries", y = "Total Deaths", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=deaths_cum, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Without US", y = "Total Deaths", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=deaths_cum, x=health_exp_pc, color = continent)) +
    geom_point()+
    labs(title = "Without US", y = "Total Deaths", x = "Health Expensees/Capita")

```

We see no positive correlation btween Total Deaths and Health Care Expenses, even after removing US as outlier. What we can infer from it is that European countries has more health expenses per capita

```{r deaths-per-population}
new <- new %>%
   mutate(dpercentage = deaths_cum/population_2019)

wo_us <- wo_us %>%
   mutate(dpercentage = deaths_cum/population_2019)
```

```{r plot-mortality-expenses-per-cap}
ggplot(new, aes(y=dpercentage, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "All Countries", y = "Total Deaths/Popluation", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=dpercentage, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Without US", y = "Total Deaths/Popluation", x = "Health Expensees/Capita")
```

Health Care Expenses per Capita still has no positive correlation with Deaths per Population.

```{r}
ggplot(wo_us, aes(y=deaths_cum, x=soc_insur_cov)) +
    geom_smooth()+
    geom_point()+
    labs(title = "", y = "Total Deaths", x = "soc_insur_cov")
```

The bump in the middle indicates that soc_insur_cov has to exceed a certain amount for it to be effective.

```{r}
ggplot(new, aes(y=dpercentage, x=soc_insur_cov)) +
    geom_smooth()+
    geom_point()+
    labs(title = "All Countries", y = "Total Deaths", x = "soc_insur_cov")
```

```{r create-dataset-healthcare}
data_health_quality <- data %>%
                    filter(elapsed == 334 & is.na(healthcare_qual) == FALSE) %>%
                    select(geoid2, region, continent, country, population_2019, pop_density, deaths_cum, healthcare_qual, health_equality)

data_health_quality_wo_us <- data_health_quality %>%
                              filter(country != 'United States')
```

```{r plot-healthcare}
ggplot(data_health_quality, aes(x = healthcare_qual, y=deaths_cum)) +
       geom_point() +
       geom_smooth() +
       labs(title = "Plot between healthcare quality and COVID-19 mortality",
            subtitle = "All countries",
            x = "Healthcare quality", y = 'Total Deaths')

ggplot(data_health_quality_wo_us, aes(x = healthcare_qual, y=deaths_cum)) +
       geom_point() +
       geom_smooth() +
       labs(title = "Plot between healthcare quality and COVID-19 mortality",
            subtitle = "US removed",
            x = "Healthcare quality", y = 'Total Deaths')

```
```{r calculate-correlations-healthcare}
# cor() function didn't work...
```
