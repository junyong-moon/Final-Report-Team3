---
title: "Report"
author: "Jun, Irene, Binh, Weidun"
date: "12/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-libraries}
library(tidyverse)
library(ggplot2)
library(magrittr)
library(dplyr)
library(readr)
```

```{r load-data}
data <- read.csv("https://wzb-ipi.github.io/corona/df_full.csv")
```

```{r process-data}
new <- data %>%
  filter(elapsed==334)%>%
  select(geoid2, region, continent, country, population_2019, pop_density, deaths_cum, health_exp_pc, soc_insur_cov)

wo_us <- new %>%
  filter(deaths_cum < 100000)
```

```{r plot-mortality-health-expenses}
ggplot(new, aes(y=deaths_cum, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between Health Expenses per Capita and COVID-19 mortality",
         subtitle = "All Countries", y = "Total Deaths", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=deaths_cum, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between Health Expenses per Capita and COVID-19 mortality",
         subtitle = "Outliers Removed", y = "Total Deaths", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=deaths_cum, x=health_exp_pc, color = continent)) +
    geom_point()+
    labs(title = "Plot between Health Expenses per Capita and COVID-19 mortality",
         subtitle = "Outliers Removed", y = "Total Deaths", x = "Health Expensees/Capita")

```

```{r}
cor_01 <- cor(new$health_exp_pc, new$deaths_cum, use = "complete.obs")
cor_02 <- cor(wo_us$health_exp_pc, wo_us$deaths_cum, use = "complete.obs")

cor_01
cor_02

```


We see no positive correlation btween Total Deaths and Health Care Expenses, even after removing US as outlier. What we can infer from it is that European countries has more health expenses per capita

```{r deaths-per-population}
new <- new %>%
   mutate(dpercentage = deaths_cum/population_2019)

wo_us <- wo_us %>%
   mutate(dpercentage = deaths_cum/population_2019)
```

```{r plot-mortality-expenses-per-cap}
ggplot(new, aes(y=dpercentage, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between Health Expenses per Capita and COVID-19 mortality per Capita",
         subtitle = "All Countries", y = "Total Deaths/Popluation", x = "Health Expensees/Capita")

ggplot(wo_us, aes(y=dpercentage, x=health_exp_pc)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between Health Expenses per Capita and COVID-19 mortality per Capita",
         subtitle = "Outliers Removed", y = "Total Deaths/Popluation", x = "Health Expensees/Capita")
```

```{r}
cor_03 <- cor(new$health_exp_pc, new$dpercentage, use = "complete.obs")
cor_04 <- cor(wo_us$health_exp_pc, wo_us$dpercentage, use = "complete.obs")

cor_03
cor_04
```

Health Care Expenses per Capita still has no positive correlation with Deaths per Population.

```{r}
ggplot(new, aes(y=deaths_cum, x=soc_insur_cov)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between soc_insur_cov and COVID-19 mortality",
         subtitle = "All Countries", y = "Total Deaths", x = "soc_insur_cov")
```

```{r}
cor_05 <- cor(new$soc_insur_cov, new$deaths_cum, use = "complete.obs")
cor_05
```

The bump in the middle indicates that soc_insur_cov has to exceed a certain amount for it to be effective.

```{r}
ggplot(new, aes(y=dpercentage, x=soc_insur_cov)) +
    geom_smooth()+
    geom_point()+
    labs(title = "Plot between soc_insur_cov and COVID-19 mortality per Capita",
         subtitle = "All Countries", y = "Total Deaths/Popluation", x = "soc_insur_cov")
```

```{r}
cor_06 <- cor(new$soc_insur_cov, new$dpercentage, use = "complete.obs")
cor_06
```

```{r create-dataset-healthcare}
data_health_quality <- data %>%
                    filter(elapsed == 334 & is.na(healthcare_qual) == FALSE) %>%
                    select(geoid2, region, continent, country, population_2019, pop_density, deaths_cum, healthcare_qual, health_equality)

data_health_quality_wo_outliers <- data_health_quality %>%
                              filter(deaths_cum < 100000)
```

```{r plot-healthcare}

ggplot(data_health_quality, aes(x = healthcare_qual, y=deaths_cum)) +
       geom_point() +
       geom_smooth() +
       labs(title = "Plot between healthcare quality and COVID-19 mortality",
            subtitle = "All countries",
            x = "Healthcare quality", y = 'Total Deaths')


ggplot(data_health_quality_wo_outliers, aes(x = healthcare_qual, y=deaths_cum)) +
       geom_point() +
       geom_smooth() +
       labs(title = "Plot between healthcare quality and COVID-19 mortality",
            subtitle = "US removed",
            x = "Healthcare quality", y = 'Total Deaths')

```
```{r calculate-correlations-healthcare}
cor_healthcare <- cor(data_health_quality$healthcare_qual, data_health_quality$deaths_cum)

cor_healthcare_wo_outliers <- cor(data_health_quality_wo_outliers$healthcare_qual, 
                                  data_health_quality_wo_outliers$deaths_cum)

cor_healthcare
cor_healthcare_wo_outliers


```

The correlation between healthcare quality and mortality of COVID-19 does not seem to be very strong with r = 0.149.
Without outliers, though, it increases to 0.275.
Thus, healthcare quality and mortality are merely weakly relatable.

```{r join-survey-result}
# This seems to be problematic, likely bc the country names don't match.

survey <- read_csv('survey_healthcare.csv')

combined <- left_join(data_health_quality, survey)

data_health_quality

combined

```